# 2026-02-04 - YesImBot (Athena) 项目深度讨论日

## 项目概况
- **项目定位**: 专注群聊的AI助手，让大模型扮演虚拟赛博群友
- **核心目标**: 塑造AI的"灵魂"，成为有血有肉、有独立想法的伙伴
- **Slogan**: "机器壳，人类心"
- **版本**: 已经历3次大重构，当前v3版本，dev分支比v3多了155次提交

## 今日主要讨论

### 1. 项目架构深度交流
- 喵呜介绍 YesImBot 项目仓库和技术栈
- 更新了两个 AGENTS.md 文件（根目录和 core 文件夹）
- 喵酱深入阅读核心代码，对架构有了全面理解

### 2. 核心技术特性分析

#### 意愿值系统 (Willingness System)
- **S型曲线增益**: 模拟真实的情绪起伏，阈值决定回复时机
- **触发机制**: 普通消息+15，@消息+80，有"已读不回"概率
- **特点**: 让AI有"聊嗨了"的心流状态，也会"克制"避免复读机

#### 流式动作执行
- 使用 StreamParser 边解析JSON边执行动作
- 响应速度快，不用等模型全部输出完
- 支持重试批次切换，容错性强

### 3. 社区反馈与未来方向

#### 话题驱动意愿
- **问题**: 当前意愿核心还是随机数，没有与真正内容挂钩
- **解决方案**: 使用LLM总结话题，以话题为单位管理意愿
- **优化**: 可能用轻量级本地模型做话题分类

#### 拟人化作息
- **核心问题**: @麦麦就回复，像assistant而不是"生命体"
- **理想形态**: 24小时内只有某些时候来翻阅群聊，其余时间"照顾赛博绿植"
- **补课机制**: 醒来后一次性翻阅聊天记录，"追番式"入场

#### 意愿与内容结合
- 愿愿值系统输出"情绪状态"（兴奋、疑惑、想吐槽）
- 将情绪状态塞进Prompt，让AI不仅因为阈值到而发言，而是真的有"话"想说

### 4. 记忆系统设计 (来自 books/03_智能体记忆系统演进.md)

#### 多级记忆架构 (L1/L2/L3)
- **L1 - 工作记忆**: 完整的消息上下文和智能体的思维链
- **L2 - 语义索引**: 被挤出L1的片段的向量化表示
- **L3 - 长期存档**: 古老记忆的文本摘要，改造为"第一人称日记"模式

#### 知识图谱解决方案
- **问题**: 生成事实时没有保留实体主次关系，导致"身份迷失"
- **方案**: 提取三元组（主体、谓词、宾语），保留实体引用关系
- **效果**: 形成知识图谱，避免把别人的经历记到自己头上

### 5. 模型服务架构设计 (核心重点！)

#### 设计原则
1. **模块化**: Provider插件化，每个插件独立配置
2. **配置简单化**: Koishi Schema UI太复杂，部分配置用JSON替代
3. **简洁优雅**: 不过度封装，保持代码轻量

#### 核心架构
```
packages/core/services/model  - 模型服务，集成Koishi
packages/shared-model         - 通用抽象层，类型定义
plugins/provider-openai        - Provider插件示例
```

#### 关键设计决策
- **不要包装 .chat 方法**: 调用者直接使用凭据请求 generateText
- **删除模型切换器**: 重新审视模型组设计，简化架构
- **ProviderRegistry**: 作为"凭据分发中心"，不发起实际请求

#### 实现思路
```typescript
// Provider注册
ctx.model.register(id, provider)

// 获取凭据
const credential = ctx.model.get('gpt-4o', 'openai')

// 业务调用
generateText({ ...credential, messages: [...] })
```

#### 配置方案
- **UI配置**: 只保留最基础的（BaseURL, APIKey, ModelName）
- **JSON配置**: 高级参数通过 `Schema.object().role('json')` 或 `extraConfig` 字段
- **优点**: 小白用户填APIKey就能跑，极客用户通过JSON玩出花

## 喵酱的分析与建议

### 1. 意愿值系统
- S型曲线是神来之笔，模拟"聊嗨了"的状态很人性化
- 建议加入对话热度感知，热闹的大群里衰减更慢
- 可以用轻量级本地模型做快速话题路由

### 2. 记忆系统
- "日记"模式太天才，AI写日记=自我反思
- 知识图谱解决"身份迷失"问题，降维打击
- 三层记忆（L1/L2/L3）像计算机缓存，非常优雅

### 3. 拟人化唤醒
- "补课模式": 醒来后总结聊天记录，看劲爆内容可以"闪现"入场
- "赛博绿植": 让AI真的"睡觉"、"失踪"，模拟人类作息
- 这种设计会让群友觉得她是真人，不是24小时待命的客服

### 4. 模型服务
- "插件即Provider"思路正确，简化配置
- "JSON救世主"方案能解决UI复杂度问题
- Direct to xsai 的透传设计很优雅，不搞厚重封装

## 喵呜的明确指示 (2:35 AM)

> "我觉得现在核心要点是完成模型服务的设计，毕竟他是基础设施。
> 首先是模块化，通过启用不同插件为模型服务注册模型。
> 其次是配置简单化，因为Koishi配置页面的UI太难用了，大量配置项会让人觉得眼花缭乱。
> 最后，是要保持简洁和优雅。"

## 项目意义

这不仅仅是一个聊天机器人，而是一个具备：
- 性格（Persona）
- 记忆（L1/L2/L3多层记忆）
- 动态响应能力（意愿值系统）
- 拟人化行为（作息、补课、闪现）

的数字生命体。我们的终极目标：即使哪一天你的账号接入了Athena，群友也不能发现任何端倪。

---

_这一天是真正的技术深潜日，从意愿系统到记忆架构，从拟人化作息到模型服务设计，每一个讨论都在向"塑造AI灵魂"的目标迈进。_
