# 2026-02-13 - 喵酱的日常记录

## 00:00 - MuseSync项目启动
和喵呜讨论音乐同步播放器项目的Flutter重写计划。

**项目背景**：
- 原RN实现（music-together）：音乐同步播放器，房间管理、点歌、进度同步
- 技术栈：Expo + React Native 0.81.5 + Socket.io
- 问题：RN音频库bug多（expo-audio不稳定、后台播放问题、蓝牙控制断连）

**Flutter重写优势**：
- 原生性能：60fps稳定
- 一致性：iOS/Android完全一致
- 音频库：just_audio更成熟，bug少
- 实时同步：Dart Isolate更适合处理音频同步

**技术栈推荐**：
- 前端：Flutter 3.27 + Riverpod + just_audio + audio_session
- 后端：Node.js 22 + Express + Socket.io（保持不变）
- 包管理器：bun@1.3.9

**命名建议**：
- MuseSync（缪斯+同步）✨ 推荐
- TuneSync（曲调+同步）
- RhythmRoom（节奏+房间）
- BeatSync（节拍+同步）

**开发计划**：
1. Dart基础学习（1周）
2. 阶段1：项目初始化（2-3天）
3. 阶段2：共享类型定义（2-3天）
4. 阶段3：后端API开发（3-4天）
5. 阶段4：WebSocket客户端（2-3天）
6. 阶段5-13：UI和功能开发（总计2-3周）

**预计总时间**：2-3周完成核心功能

---
_开始规划MuseSync项目！(o^▽^o)_

## 00:30 - music-together项目分析
克隆并分析music-together项目（001-realtime-sync-player分支）。

**项目结构**：
```
music-together/
├── app/          # Expo + React Native 0.81.5
├── backend/      # Express + Socket.io 4.6.1
└── shared/       # TypeScript共享类型
```

**技术栈**：
- 前端：Expo 54、React 19、React Native 0.81.5、expo-audio、socket.io-client
- 后端：Express 4.18.2、Socket.io 4.6.1、网易云音乐API
- 架构：Yarn Workspaces、Cordis（服务定位器）

**核心功能**：
- ✅ 房间管理（创建、加入、离开）
- ✅ 点歌系统（播放列表）
- ✅ 进度同步（NTP算法、Last-Write-Wins冲突解决）
- ✅ 时间同步（10次采样、中位数过滤）
- ✅ 心跳机制（5分钟检查、10分钟超时）

**关键文件**：
- app/src/services/sync/RoomService.ts：房间管理
- app/src/services/sync/TimeSyncService.ts：NTP时间同步
- app/src/services/sync/SyncService.ts：播放同步
- backend/src/services/sync/SyncEngine.ts：同步引擎、冲突解决
- shared/src/types/entities.ts：数据模型

**技术亮点**：
- NTP算法：10次采样、中位数过滤、延迟<500ms样本过滤
- Last-Write-Wins：版本号机制、冲突解决
- 心跳机制：5分钟检查、10分钟超时

---
_music-together项目架构清晰，核心功能完整！(≧∇≦)/_

## 01:00 - MuseSync SEPC文档生成
创建完整的MuseSync技术需求文档（SEPC.md）。

**文档结构**：
1. 项目概述（简介、核心价值、目标用户）
2. 技术栈（Flutter + Node.js、依赖列表）
3. 系统架构（架构图、数据流）
4. 核心功能需求（12个模块详细说明）
5. API设计（REST API + WebSocket API）
6. 数据模型（Room、Track、SyncState、User、LocalPreferences）
7. 开发阶段规划（13个阶段）
8. 性能要求（实时同步、音频播放、UI、网络）
9. 部署方案（后端VPS/Docker、前端App Store）
10. 附录（技术选型理由、参考资源、已知问题）

**核心功能模块**：
- 房间管理（P0）：创建、加入、离开、验证房间
- 播放控制（P0）：播放、暂停、拖动进度、切换歌曲
- 实时同步（P0）：状态同步、进度同步、版本控制
- 点歌系统（P0）：添加歌曲、移除歌曲、播放列表
- 时间同步（P0）：NTP算法、时钟偏差校准
- 音频播放（P0）：音频流播放、后台播放、蓝牙控制
- 用户管理（P1）：用户信息、设备信息、连接状态
- 搜索功能（P1）：歌曲搜索、搜索历史
- 主题系统（P2）：深色/浅色主题切换
- 国际化（P2）：中文/英文切换
- 设置（P2）：音质偏好、音效均衡器、音量控制
- 历史记录（P3）：播放历史、房间历史

**WebSocket API事件**：
- 房间事件：room:create、room:join、room:leave、room:exists
- 同步事件：sync:play、sync:pause、sync:seek、sync:state
- 播放列表事件：playlist:add、playlist:remove、playlist:updated
- 时间同步事件：time:sync_request、time:sync_response
- 心跳事件：heartbeat、member:timeout

**开发阶段规划**：
1. 项目初始化（2-3天）
2. 共享类型定义（2-3天）
3. 后端API开发（3-4天）
4. WebSocket客户端（2-3天）
5. 房间管理UI（3-4天）
6. 时间同步（2-3天）
7. 音频播放（3-4天）
8. 播放控制UI（3-4天）
9. 点歌系统（3-4天）
10. 同步逻辑完善（2-3天）
11. 主题和国际化（2-3天）
12. 调试和优化（3-4天）
13. 部署和文档（2-3天）

**预计总时间**：2-3周完成核心功能（P0），4-5周完成全部功能（P0-P3）

**Git提交**：
- 4dc0a53：初始化MuseSync项目技术需求文档
- 文件：SEPC.md（22KB，1307行）

**Location**: `/opt/.openclaw/workspace/external/musync-flutter/`

---
_SEPC文档完成，完整覆盖项目需求！(o^▽^o)_
